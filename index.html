<html>
<head>
	<title>Online Notepad</title>
	<link rel="stylesheet" type="text/css" href="style.css">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
	
</head>

<body>
	<div class="container">
		<header class="d-flex flex-wrap justify-content-center py-3 mb-4 border-bottom" style="width:100%">
		  <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-dark text-decoration-none">
			<svg class="bi me-2" width="40" height="32"><image href="note.png" width="40px" height="32px"></image></svg>
			<span class="fs-4">Online Notepad</span>
		  </a>
		</header>
	  </div>
	<div id='main'>
		<div class="container-fluid" style="padding-top:10px">
		<textarea placeholder='Enter your note here!' class="form-control" id='t' ></textarea><br>
		</div><center><p style = "font-size: 25px;">Share your note using the link <p id='url'></p></p></center>
	</div>
	<footer class="footer mt-auto position-sticky top-100 start-10  bg-light">
		<div class="container py-1">
		  <span class="text-muted">A Project by Karthik</span>
		</div>
	  </footer>
	<script type="module" id="imports">
		document.getElementById('url').innerHTML = window.location.href;
		import { initializeApp } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js";
		import {getDatabase,ref,set,onValue,child,get} from "https://www.gstatic.com/firebasejs/9.14.0/firebase-database.js";
		const Params = new URLSearchParams(window.location.search);
		var id  = Params.get('id');
		
		// TODO: Add SDKs for Firebase products that you want to use
		// https://firebase.google.com/docs/web/setup#available-libraries
			
		// Your web app's Firebase configuration
		const firebaseConfig = {
			apiKey: "AIzaSyBcwoOf8skOfhI-FwxXR9cnJoiY0ovMpZs",
			authDomain: "onlinenotepad1.firebaseapp.com",
			projectId: "onlinenotepad1",
			storageBucket: "onlinenotepad1.appspot.com",
			messagingSenderId: "310187430928",
			appId: "1:310187430928:web:f2e7406713ce62cdfd6695",
			databaseURL:"https://onlinenotepad1-default-rtdb.firebaseio.com/"
		};
		const app = initializeApp(firebaseConfig);	
		// Initialize Firebase
		
		const characters ='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
		const db = getDatabase();
		console.log(id);
		onValue(ref(db,'users/'+id+'/note'), (snapshot) => {
  			const data = snapshot.val();
  			document.getElementById('t').value = data;
		});
		function generateString(length) {
			let result = ' ';
			const charactersLength = characters.length;
			for ( let i = 0; i < length; i++ ) {
				result += characters.charAt(Math.floor(Math.random() * charactersLength));
			}

			return result;
		}
		if (id==null){
			
			
				var id_random = generateString(5);
				console.log(id_random);
				
				console.log(document.location.search);
				get(child(ref(db), `users/${id_random}`)).then((snapshot) => {
					if (snapshot.exists()==true) {
						console.log(snapshot.exists())
						document.location.href = document.location.pathname;
					} else {    
						console.log("No data available");
						document.location.href = document.location.pathname + "?id="+id_random;
						
					}
				}).catch((error) => {
					console.error(error);
				});
		
		}
		document.getElementById('t').addEventListener('keyup',function(){
			set(ref(db,'users/'+id),{
				note:document.getElementById('t').value,
			})
		})
	</script>	
</body>
</html>